<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Voter Management | E-Voting</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="font-sans bg-gray-100 text-gray-800">
<div class="flex h-screen overflow-hidden">
  <main class="flex-1 p-8 overflow-y-auto">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-indigo-700">Voter List</h1>
        <button onclick="toggleModal()" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">+ Register New Voter</button>
    </div>

    <div class="bg-white shadow rounded-lg overflow-hidden">
      <table class="min-w-full leading-normal">
        <thead>
          <tr class="bg-indigo-100 text-left text-xs font-semibold text-gray-600 uppercase">
            <th class="px-5 py-3">Voter ID</th>
            <th class="px-5 py-3">Full Name</th>
            <th class="px-5 py-3">Mobile</th>
            <th class="px-5 py-3">Status</th>
          </tr>
        </thead>
        <tbody id="votersTableBody"></tbody>
      </table>
    </div>

    <div id="registerModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden flex items-center justify-center">
      <div class="bg-white p-8 rounded-lg shadow-xl w-96">
        <h2 class="text-xl font-bold mb-4">Register Voter</h2>
        <form id="registerForm" class="space-y-4">
          <input type="text" id="regName" placeholder="Full Name" required class="w-full border p-2 rounded">
          <input type="text" id="regMobile" placeholder="Mobile Number" required class="w-full border p-2 rounded">
          <input type="text" id="regAadhaar" placeholder="Aadhaar Number" required class="w-full border p-2 rounded">
          <div class="flex justify-end space-x-2">
            <button type="button" onclick="toggleModal()" class="bg-gray-300 px-4 py-2 rounded">Cancel</button>
            <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded">Register</button>
          </div>
        </form>
      </div>
    </div>
  </main>
</div>

<script>
async function fetchVoters() {
  const response = await fetch('/api/admin/voters', {
    headers: { 'Authorization': `Bearer ${localStorage.getItem('admin_token')}` }
  });
  const result = await response.json();
  if (result.success) {
    document.getElementById('votersTableBody').innerHTML = result.data.map(v => `
      <tr class="border-b">
        <td class="px-5 py-4">${v.VoterID}</td>
        <td class="px-5 py-4">${v.FullName}</td>
        <td class="px-5 py-4">${v.Mobile}</td>
        <td class="px-5 py-4">${v.IsVerified ? '✅ Verified' : '❌ Pending'}</td>
      </tr>
    `).join('');
  }
}

document.getElementById('registerForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const payload = {
    full_name: document.getElementById('regName').value,
    mobile: document.getElementById('regMobile').value,
    aadhaar: document.getElementById('regAadhaar').value
  };

  const response = await fetch('/api/admin/voter/register', {
    method: 'POST',
    headers: { 
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${localStorage.getItem('admin_token')}`
    },
    body: JSON.stringify(payload)
  });

  const result = await response.json();
  if (result.success) {
    alert("Voter Registered! ID: " + result.data.voter_id);
    toggleModal();
    fetchVoters();
  } else {
    alert(result.error);
  }
});

function toggleModal() {
  document.getElementById('registerModal').classList.toggle('hidden');
}

fetchVoters();
</script>
</body>
</html>