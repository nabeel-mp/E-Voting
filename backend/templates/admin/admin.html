<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>System Administrators | E-Voting</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
      body { font-family: 'Inter', sans-serif; }
      @keyframes gradient-move { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
      .animate-gradient { background-size: 200% 200%; animation: gradient-move 15s ease infinite; }
      .sidebar-entrance { animation: slide-right-fade 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
      @keyframes slide-right-fade { 0% { opacity: 0; transform: translateX(-20px); } 100% { opacity: 1; transform: translateX(0); } }
      ::-webkit-scrollbar { width: 8px; }
      ::-webkit-scrollbar-track { background: #0f172a; }
      ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-slate-900 to-indigo-950 animate-gradient text-slate-200 h-screen overflow-hidden">
<div class="flex h-full">
    <aside id="sidebar" class="sidebar-entrance w-64 bg-slate-900/80 backdrop-blur-md border-r border-slate-700/50 flex flex-col z-20 shadow-2xl">
    <div class="p-6 flex items-center gap-3">
        <div class="h-8 w-8 rounded-lg bg-indigo-500/20 border border-indigo-400/30 flex items-center justify-center text-indigo-400 shadow-[0_0_15px_rgba(79,70,229,0.2)]">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 01-1.043 3.296 3.745 3.745 0 01-3.296 1.043A3.745 3.745 0 0112 21c-1.268 0-2.39-.63-3.068-1.593a3.745 3.745 0 01-3.296-1.043 3.745 3.745 0 01-1.043-3.296A3.745 3.745 0 013 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 011.043-3.296 3.745 3.745 0 013.296-1.043A3.745 3.745 0 0112 3c1.268 0 2.39.63 3.068 1.593a3.745 3.745 0 013.296 1.043 3.745 3.745 0 011.043 3.296A3.745 3.745 0 0121 12z" />
            </svg>
        </div>
        <span class="text-xl font-bold text-white tracking-tight">E-Voting</span>
    </div>

    <nav class="flex-1 px-4 py-4 overflow-y-auto">
        <ul id="navList" class="space-y-1">
            </ul>
    </nav>

    <div class="p-4 border-t border-slate-700/50">
        <div id="userInfo" class="flex items-center gap-3">
            </div>
    </div>
</aside>

  <main class="flex-1 p-8 overflow-y-auto relative">
    <div class="absolute top-0 left-0 w-full h-32 bg-gradient-to-b from-indigo-500/10 to-transparent pointer-events-none"></div>
    
    <div class="flex justify-between items-center mb-8 relative z-10">
        <div>
            <h1 class="text-3xl font-bold text-white tracking-tight">System Administrators</h1>
            <p class="text-slate-400 text-sm mt-1">Manage admin access and roles.</p>
        </div>
        <button onclick="fetchAdmins()" class="bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-2 rounded-lg text-sm font-medium shadow-lg shadow-indigo-500/20 transition-all flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
            Refresh List
        </button>
    </div>

    <div class="bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-2xl overflow-hidden shadow-xl relative z-10">
      <table class="min-w-full text-left">
        <thead class="bg-slate-900/50 text-slate-400 uppercase text-xs font-semibold tracking-wider">
          <tr>
            <th class="px-6 py-4">Email Address</th>
            <th class="px-6 py-4">Role</th>
            <th class="px-6 py-4">Status</th>
            <th class="px-6 py-4 text-right">Actions</th>
          </tr>
        </thead>
        <tbody id="adminsTable" class="divide-y divide-slate-700/50 text-sm text-slate-300">
            <tr><td colspan="4" class="px-6 py-8 text-center text-slate-500">Loading administrators...</td></tr>
        </tbody>
      </table>
    </div>
  </main>
</div>

<script src="assets/js/main.js"></script>
<script>
async function fetchAdmins() {
    const table = document.getElementById("adminsTable");
    try {
        // Note: Using standard fetch here to match the dashboard style without depending on api.js
        // Ensure the endpoint matches your backend route structure (e.g., /api/admin/list or /auth/admin/list)
        const response = await fetch("/auth/admin/list", {
            headers: { 
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('admin_token')}` 
            }
        });
        
        // Handle non-200 responses if necessary
        if (!response.ok) throw new Error("Failed to fetch");

        const result = await response.json();
        
        // Adapting to generic response structure (result.data or just result)
        const admins = result.data || result; 

        if (admins.length === 0) {
            table.innerHTML = '<tr><td colspan="4" class="px-6 py-8 text-center text-slate-500">No administrators found.</td></tr>';
            return;
        }

        table.innerHTML = admins.map(a => `
            <tr class="hover:bg-slate-700/30 transition-colors">
                <td class="px-6 py-4 font-medium text-white">${a.email}</td>
                <td class="px-6 py-4">
                    <span class="px-2.5 py-1 rounded-full text-xs font-medium border ${
                        a.role_name === 'SUPER_ADMIN' 
                        ? 'bg-purple-500/10 text-purple-400 border-purple-500/20' 
                        : 'bg-indigo-500/10 text-indigo-400 border-indigo-500/20'
                    }">
                        ${a.role_name}
                    </span>
                </td>
                <td class="px-6 py-4">
                    <span class="inline-flex items-center gap-1.5 px-2 py-1 rounded text-xs font-medium ${
                        a.is_active ? 'text-emerald-400' : 'text-rose-400'
                    }">
                        <span class="w-1.5 h-1.5 rounded-full ${a.is_active ? 'bg-emerald-400' : 'bg-rose-400'}"></span>
                        ${a.is_active ? 'Active' : 'Blocked'}
                    </span>
                </td>
                <td class="px-6 py-4 text-right">
                    <button onclick="toggleStatus(${a.id}, ${a.is_active})" 
                            class="text-xs font-medium px-3 py-1.5 rounded transition-colors ${
                                a.is_active 
                                ? 'bg-rose-500/10 text-rose-400 hover:bg-rose-500/20 hover:text-rose-300 border border-rose-500/20' 
                                : 'bg-emerald-500/10 text-emerald-400 hover:bg-emerald-500/20 hover:text-emerald-300 border border-emerald-500/20'
                            }">
                        ${a.is_active ? 'Block Access' : 'Unblock Access'}
                    </button>
                </td>
            </tr>
        `).join('');
    } catch (err) {
        console.error(err);
        table.innerHTML = '<tr><td colspan="4" class="px-6 py-8 text-center text-rose-400">Failed to load administrator list.</td></tr>';
    }
}

async function toggleStatus(id, currentStatus) {
    if(!confirm(`Are you sure you want to ${currentStatus ? 'block' : 'unblock'} this admin?`)) return;

    const endpoint = currentStatus ? "/auth/admin/block" : "/auth/admin/unblock";
    try {
        await fetch(endpoint, {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('admin_token')}` 
            },
            body: JSON.stringify({ admin_id: id })
        });
        fetchAdmins();
    } catch (err) {
        alert("Action failed. Please check your connection.");
    }
}

fetchAdmins();
</script>
</body>
</html>